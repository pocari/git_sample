#!/bin/sh

#                        
# masterから派生したbranch01を一旦プルリクエストして、また反映していない場合に、
# branch01の続きに行いたい作業をbranch01から派生したbranch01-exで作業し、
# branch01がmasterにマージされた後にそこから、branch02を作成し、branch01-exを
# branch02にrebaseして、branch02の変更内容としてmasterにマージする直前まで
#
# master   1---------3-------------M------+---6--------------
#              |                   ^      |
#              |                   |      |
# branch01     \--2--+-------------+      |
#                    |                    |
# branch01-ex        \----4---5-----X     |  (branch01-exはXで終了して、新たに4', 5'としてbranch02にrebaseする
#                                         |
# branch02                                \-@---(4')--(5')--
#
#
# @にいるときに、
#   git checkout branch01-ex
#   git rebase branch02
# で、branch01-exがrebaseされるので、その後
#   git checkout branch02
#   git merge branch01-ex
# すると、branch01のプルリクがmasterにマージされる前に行ったcommit4, 5が、
# masterへのマージ後の状態から派生したブランチに対して行ったかのように見える
#
#---------------------------------------------------------
#commit 1 
cat <<EOS > file01.txt
text01

@@@@@@@@@@@@@@@@@@@@@
EOS

git init
git add file01.txt
git commit -m "commit 1"

#---------------------------------------------------------
#commit 2 
git checkout -b branch01
cat <<EOS > file01.txt
text01

@@@@@@@@@@@@@@@@@@@@@
text02
EOS

git add file01.txt
git commit -m "commit 2"

#---------------------------------------------------------
#commit 3 
git checkout master
cat <<EOS > file01.txt
text01
text03

@@@@@@@@@@@@@@@@@@@@@
EOS

git add file01.txt
git commit -m "commit 3"

#---------------------------------------------------------
#commit 4
git checkout branch01
git checkout -b branch01-ex
cat <<EOS > file01.txt
text01

@@@@@@@@@@@@@@@@@@@@@
text02
text02-text04
EOS

git add file01.txt
git commit -m "commit 4"

#---------------------------------------------------------
#commit 5
cat <<EOS > file01.txt
text01

@@@@@@@@@@@@@@@@@@@@@
text02
text02-text04
text05
EOS

git add file01.txt
git commit -m "commit 5"

#---------------------------------------------------------
#merge branch01 to master
git checkout master
git merge branch01

#---------------------------------------------------------
# create branch02
git checkout -b branch02 

#---------------------------------------------------------
# commit 6
git checkout master
cat <<EOS > file01.txt
text01
text03
text06

@@@@@@@@@@@@@@@@@@@@@
text02
EOS

git add file01.txt
git commit -m "commit 6"

#--------------------------------------------
# 今から(4'), (5')を作るところでストップ

